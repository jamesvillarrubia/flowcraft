
> flowcraft@1.0.0 test
> vitest --coverage --run tests/unit/


 RUN  v2.1.9 /Users/james/Sites/published/flowcraft
      Coverage enabled with v8

 ✓ tests/unit/versioning.test.ts (13 tests) 16ms
 ❯ tests/unit/idempotency-extended.test.ts (15 tests | 1 failed) 18ms
   × IdempotencyManager - Extended Coverage > hasChanges > should return true when config hash changes 6ms
     → expected false to be true // Object.is equality
 ❯ tests/unit/idempotency.test.ts (12 tests | 1 failed) 18ms
   × IdempotencyManager > updateCache > should create cache file 5ms
     → expected false to be true // Object.is equality
 ✓ tests/unit/config.test.ts (9 tests) 15ms
 ✓ tests/unit/ast-path-operations-extended.test.ts (32 tests) 33ms
 ✓ tests/unit/pipeline-path-based.test.ts (21 tests) 126ms
 ✓ tests/unit/job-order.test.ts (4 tests) 1647ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 2 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/unit/idempotency-extended.test.ts > IdempotencyManager - Extended Coverage > hasChanges > should return true when config hash changes
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 ❯ tests/unit/idempotency-extended.test.ts:148:26
    146|       
    147|       const hasChanges = await idempotencyManager.hasChanges()
    148|       expect(hasChanges).toBe(true)
       |                          ^
    149|     })
    150| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯

 FAIL  tests/unit/idempotency.test.ts > IdempotencyManager > updateCache > should create cache file
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 ❯ tests/unit/idempotency.test.ts:107:37
    105|       
    106|       const cacheFile = join(TEST_DIR, '.flowcraft-cache.json')
    107|       expect(existsSync(cacheFile)).toBe(true)
       |                                     ^
    108|     })
    109| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯

 Test Files  2 failed | 5 passed (7)
      Tests  2 failed | 104 passed (106)
   Start at  23:47:45
   Duration  2.15s (transform 203ms, setup 144ms, collect 515ms, tests 1.87s, environment 1ms, prepare 536ms)

